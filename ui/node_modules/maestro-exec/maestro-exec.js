"use strict";

var executable = require('executable');
var exec = require('child_process').exec,
    child;

var maestroexec =  module.exports = {

    /* future use  */
    RUN_LOCAL : true,
    /*
    defaults :  {
        env: process.env.NODE_ENV || 'development',
        config: {
            paths: {
                environments: __dirname + '/environments'
            }
        }
    },
    */

    execCmd: function(cmd, params, options, callback) {
             this.execLocal(cmd, params, options, callback);
    },

    /*execCmd: function(cmd, params, callback) {
       this.execLocal(cmd, params, function(code, error) {
           (error) ? callback(false) : callback(true);
       });
    },*/

    execLocal: function(cmd, params, options, callback) {
        try {
            if (executable.sync(cmd)) {
                child = exec(((params) ? cmd + ' ' + params : cmd), function (error, stdout, stderr) {
                    if(options && options.status_only) {
                        (error) ? callback(false, null) : callback(true, null);
                    } else {
                        if (error) {
                            callback(null, error);
                        }
                        else {
                            callback(stdout, null);
                        }
                    }
                });
                /*
                child.on('exit', function (code) {
                    (code == 0) ? callback(code, null) : callback(null, code);
                });
                */
            }
        } catch (e) {
            if(options && options.status_only) {
                callback(false, null);
            } else {
                callback(null, e.message);
            }
        }
    }

};

