var config_yaml = require('config-yaml/config-yaml').get_config_yaml();
var http = require('http');

var blueprint_utils = {
  get_blueprint_id: function(err, id){
    var url = config_yaml.blueprint.protocol + '://' + config_yaml.blueprint.ip + ':' + config_yaml.blueprint.port + config_yaml.blueprint.resource_uri + '/id';
    
    var reqGet = http.get(url, function(res) {
      res.on('data', function (chunk) {
        if(res.statusCode == 500){
          err({ message: JSON.parse(chunk) });
        }else if(res.statusCode == 404){
          err({ message: JSON.parse(chunk) });
        }else{
          id(chunk);
        }
      });
      
      res.on('error', function(e){
        console.log('Error get_blueprint_id:'+e.message);
        err(e);
      });
    });
    
    reqGet.end();
    reqGet.on('error', function (e) {
      console.log('Error closing the request get_blueprint_id:'+e.message);
      err(e);
    });
    
  },
  get_current_raw_bp: function(err, raw_bp){
    var url = config_yaml.blueprint.protocol + '://' + config_yaml.blueprint.ip + ':' + config_yaml.blueprint.port + config_yaml.blueprint.resource_uri + '/current_raw_bp';
    
    var reqGet = http.get(url, function(res) {
      res.on('data', function (chunk) {
        if(res.statusCode == 500){
          err({ message: JSON.parse(chunk) });
        }else if(res.statusCode == 404){
          err({ message: JSON.parse(chunk) });
        }else{
          raw_bp(chunk);
        }
      });
      
      res.on('error', function(e){
        console.log('Error get_blueprint_id:'+e.message);
        err(e);
      });
    });
    
    reqGet.end();
    reqGet.on('error', function (e) {
      console.log('Error closing the request get_blueprint_id:'+e.message);
      err(e);
    });
  },
  get_blueprint_section: function(id, section, err, result){
    var url = config_yaml.blueprint.protocol + '://' + config_yaml.blueprint.ip + ':' + config_yaml.blueprint.port + config_yaml.blueprint.resource_uri + '?id=' + id + '&model=' + section;
    
    var reqGet = http.get(url, function(res) {
      res.on('data', function (chunk) {
        if(res.statusCode == 500){
          err({ message: JSON.parse(chunk) });
        }else if(res.statusCode == 404){
          err({ message: JSON.parse(chunk) });
        }else{
          result(chunk);
        }
      });
      
      res.on('error', function(e){
        console.log('Error get_blueprint_id:'+e.message);
        err(e);
      });
    });
    
    reqGet.end();
    reqGet.on('error', function (e) {
      console.log('Error closing the request get_blueprint_id:'+e.message);
      err(e);
    });
  }
}

module.exports = blueprint_utils;