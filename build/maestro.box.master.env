# (c) Copyright 2014 Hewlett-Packard Development Company, L.P.

#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.

# Please READ carefully the `maestro/build/README.md' on how bootstrapping is built to update this file accordingly.
#
# This is given as an example to build your Maestro box. You will need to adapt it for your need.

# Build Configuration FileName convention
# =======================================
#
# This build configuration file name is built from 3 variables set by build.sh
# {APP_PATH}.{BUILD_CONFIG}.{GITBRANCH].env
#
# GITBRANCH is 'master' by default. or Current GIT branch if option --gitBranchCur, or any valid branch set by --gitBranch <BranchName>
# APP_PATH is set from --box-name <BoxName>
# BUILD_CONFIG is set from --build-config

# When you start your build, the server name will be set by BUILD_ID.
# This variable can be set by --build_ID option.
# If you want to ignore --build_ID, you canf for it by uncomment the following line and set your desired BUILD_ID
# BUILD_ID=MyBuild



# Using --build-config <Config>(with or without --build-conf-dir) will load information about:
# - BUILD_ID                : Optionally force to use a build ID.
PREFIX=maestro.
if [ "${BUILD_ID}" = "" ]
then
   BUILD_ID=bld
fi
BUILD_ID=$PREFIX$BUILD_ID
# - APPPATH                 : Path to bootstrap files to use.
# 
# Defines which HPCloud project to use.
# hpcloud Account name used. hpcloud maintains a local login cache. To avoid caching issue, we recommend to HAVE an account per branch.
FORJ_HPC=master-maestro-build-13.05
# If this account doesn't exist, build.sh will create it from hp account.

# To ensure the FORJ_HPC account is configured correctly, set any hpcloud services you want to set and use.

# HPCloud services to configure:
# - FORJ_HPC_TENANTID       : HPCloud Project tenant ID used.
# - FORJ_HPC_COMPUTE        : HPCloud compute service to use.
FORJ_HPC_COMPUTE=region-a.geo-1
# - FORJ_HPC_NETWORKING     : HPCloud networking service to use.
FORJ_HPC_NETWORKING=region-a.geo-1
# - FORJ_HPC_CDN            : HPCloud CDN service to use.
# - FORJ_HPC_OBJECT_STORAGE : HPCloud Object storage service to use.
# - FORJ_HPC_BLOCK_STORAGE  : HPCloud Block storage service to use.
FORJ_HPC_BLOCK_STORAGE=region-a.geo-1
# - FORJ_HPC_DNS            : HPCloud Domain name service to use.
# - FORJ_HPC_LOAD_BALANCER  : HPCloud Load balancer service to use.
# - FORJ_HPC_MONITORING     : HPCloud Monitoring service to use.
# - FORJ_HPC_DB             : HPCloud Mysql service to use.
# - FORJ_HPC_REPORTING      : HPCloud Reporting service to use.

# Boot data needed:
# Required! Uncomment it and update it. This is your HPCloud public key used. Build.sh will add this key in the hpcloud boot call.
# FORJ_HPC_NOVA_KEYPUB=~/.hpcloud/keypairs/nova.pub
# - FORJ_HPC_NET or FORJ_HPC_NETID : HPCloud Image name or Image ID to use for boot.
FORJ_HPC_NET="private"
# - FORJ_BASE_IMG                  : HPCloud image ID to use for boot.
# Ubuntu Precise 12.04 LTS Server 64-bit 20121026 (b) - proto2b
FORJ_BASE_IMG="proto2b"
# - FORJ_FLAVOR                    : HPCloud flavor ID to use for boot.
# standard.xsmall (RAM=1024, HD=10GB)
FORJ_FLAVOR=100
# - BOOTSTRAP_DIR                  : Superseed default <BoxName> bootscripts. See Box bootstrap section for details.
                           

# Setting default META. If one of this value was set from the command line option, it will replace this one.
if [ "${META[cdksite]}" = "" ]
then # Default
   META[cdksite]="cdksite=${BUILD_ID}"
fi
if [ "${META[cdkdomain]}" = "" ]
then
   META[cdkdomain]="cdkdomain=forj.io"
fi
if [ "${META[eroip]}" = "" ]
then
   META[eroip]="eroip=127.0.0.1"
fi
if [ "${META[erosite]}" = "" ]
then
   META[erosite]="erosite=${BUILD_ID}"
fi
if [ "${META[erodomain]}" = "" ]
then
   META[erodomain]="erodomain=forj.io"
fi

if [ "${META[gitbranch]}" = "" ]
then
   META[gitbranch]="gitbranch=$GITBRANCH"
fi

# Next meta-data are used to automatically provision a blueprint requested by FORJ.
if [ "${META[security_groups]}" = "" ]
then
   META[security_groups]="security_groups=default"
fi
if [ "${META[tenantid]}" = "" ]
then
   META[tenantid]="tenantid=$FORJ_HPC_TENANTID"
fi

# This meta data is required by ../../../bootstrap/maestro/05-forj-fog.sh
if [ "${META[hpcloud-version]}" = "" ]
then
   META[hpcloud-version]="hpcloud-version=Transition-13.5"
fi


if [ "${META[blueprint]}" = "" ]
then
   META[blueprint]="blueprint=openstack"
fi

if [ "${META[network_name]}" = "" ]
then
   # This configuration is designed for hpcloud 13.5 which requires to have a private network_name defined to create boxes. Adding a default 'private' one.
   META[network_name]="network_name=private"
fi



if [ "${META[PUPPET_DEBUG]}" = "" ]
then
   # By default, Maestro puppet code are displayed with --debug and --verbose. To remove them, change Value from True to False.
   META[PUPPET_DEBUG]="PUPPET_DEBUG=True"
fi


# This configuration will not create any image, but a box.
Info "This configuration cannot create an image."
DEBUG=True
